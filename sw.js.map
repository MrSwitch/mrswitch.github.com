{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/indexdb.js","src/sw.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sw.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// indexStorage\n// This wraps an interface around IndexDB to create an object store\n\n// Create an instance of the db\n// The Cache name is optional, it will allow us to group various datasets (the default is __tricks__)\n\nclass DB {\n\tconstructor (name, version, schema) {\n    // Define the schema to use in the connection\n\t\tthis.db_name = name || '__tricks__';\n\t\tif (typeof version === 'object') {\n\t\t\tthis.version = 1;\n\t\t\tthis.schema = version;\n\t\t}\n\t\telse {\n\t\t\tthis.version = version || 1;\n\t\t\tthis.schema = schema;\n\t\t}\n\t\tthis.table_name = '__tricks__';\n\n    // Return a function\n\t\treturn Object.assign(this.scope.bind(this), this);\n\t}\n\n\tscope (name) {\n    // Create a new store instance\n\t\tconst inst = Object.create(this);\n\t\tinst.table_name = name;\n\t\treturn inst;\n\t}\n\n\topen(mode) {\n\t\treturn new Promise((accept, reject) => {\n\t\t\tconst db = self.indexedDB.open(this.db_name, this.version);\n\t\t\tdb.onsuccess = event => {\n\t\t\t\taccept(event.target.result);\n\t\t\t};\n\t\t\tdb.onerror = reject;\n\t\t\tdb.onupgradeneeded = event => {\n\t\t\t\tconst db = event.target.result;\n        // this should probably do something;\n\t\t\t\tfor (const x in this.schema) {\n\t\t\t\t\tif (!db.objectStoreNames.contains(x)) {\n\t\t\t\t\t\tdb.createObjectStore(x, this.schema[x]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t})\n    .then(db => {\n\n      // Does the store requested exist?\n      // if (!db.objectStoreNames.contains(this.table_name)) {\n      //   db.transaction('versionchange').createObjectStore(this.table_name, this.schema[this.table_name]);\n      // }\n\n      // The DB connection has been established\n      // Lets create a connection to it\n\tconst transaction = db.transaction([this.table_name], mode);\n\n      // Return the API for the Object Store\n\treturn transaction.objectStore(this.table_name);\n});\n\t}\n\n\tget (key) {\n\n    // We've got all the information to make a request to IndexDB\n\t\treturn new Promise((accept, reject) => {\n\t\t\tthis.open().then(objectStore => {\n          // Find items in this table by Key\n\t\t\t\tconst request = objectStore.get(key);\n\t\t\t\trequest.onsuccess = event => {\n\t\t\t\t\taccept(event.target.result);\n\t\t\t\t};\n\t\t\t\trequest.onerror = event => {\n\t\t\t\t\treject(event.target.result);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tall () {\n\n    // We've got all the information to make a request to IndexDB\n\t\treturn new Promise((accept, reject) => {\n\t\t\tthis.open().then(objectStore => {\n          // Find items in this table by Key\n\t\t\t\tconst request = objectStore.openCursor();\n\t\t\t\trequest.onerror = event => {\n\t\t\t\t\treject(event.target.result);\n\t\t\t\t};\n\n\t\t\t\tconst a = [];\n\t\t\t\trequest.onsuccess = event => {\n\t\t\t\t\tconst cursor = event.target.result;\n\t\t\t\t\tif (cursor) {\n\t\t\t\t\t\ta.push(cursor.value);\n\t\t\t\t\t\tcursor.continue();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\taccept(a);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n\n\tput (key, data) {\n\n\t\treturn new Promise((accept, reject) => {\n\n      // Allow data as a thing on its own.\n\t\t\tif (typeof key === 'object') {\n\t\t\t\tdata = key;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdata.key = key;\n\t\t\t}\n\n      // Open up a connection to indexdb\n\t\t\tthis.open('readwrite').then(objectStore => {\n\t\t\t\tconst request = objectStore.put(data);\n\t\t\t\trequest.onsuccess = event => {\n\t\t\t\t\taccept(event.target.result);\n\t\t\t\t};\n\t\t\t\trequest.onerror = event => {\n\t\t\t\t\treject(event.target.result);\n\t\t\t\t};\n\t\t\t})\n      .catch(reject);\n\n\t\t});\n\n\t}\n}\n\nmodule.exports = DB;\n","// Service Worker\n// Caches pages visited by agent for viewing offline\n\nconst CACHE_NAME = 'adodson_sw';\nconst VERSION = 1;\n\nconst DB = require('./indexdb');\nconst db = new DB('adodson_sw', VERSION, {\n\tfalloverStore: {\n\t\tautoIncrement: true\n\t}\n});\n\nconst falloverStore = db('falloverStore');\n\nself.addEventListener('install', event => {\n\t// Perform install steps\n\tevent.waitUntil(\n\t\tcaches.open(CACHE_NAME).then(() => {\n\t\t\t// Opened cache\n\t\t})\n\t);\n});\n\nself.addEventListener('fetch', event => {\n\tconst request = event.request;\n\tevent.respondWith(fetch(event.request)\n\t.then(response => {\n\t\t\t// Check if we received a valid response\n\t\tif (!response || response.status !== 200 || response.type !== 'basic') {\n\t\t\treturn response || caches.match(event.request);\n\t\t}\n\n\t\tconst responseToCache = response.clone();\n\n\t\tcaches.open(CACHE_NAME).then(cache => {\n\t\t\tcache.put(event.request, responseToCache);\n\t\t});\n\n\t\treturn response;\n\t},\n\t() =>\n\t\t// return the cached version\n\t\tcaches.match(event.request).then(resp => {\n\n\t\t\t// Fallover\n\t\t\tif (resp) {\n\t\t\t\treturn resp;\n\t\t\t}\n\n\t\t\t// Does this have a fallover?\n\t\t\treturn falloverStore.all().then(fallover => {\n\n\t\t\t\tconst match = fallover.filter(item => (\n\t\t\t\t\t(!item.mode || item.mode === request.mode)\n\t\t\t\t\t&& (!item.url || request.url.match(item.url))\n\t\t\t\t))[0];\n\n\t\t\t\tif (match) {\n\t\t\t\t\treturn caches.match(new Request(match.fallover));\n\t\t\t\t}\n\n\t\t\t\treturn resp;\n\t\t\t});\n\t\t})\n\t));\n});\n\nself.addEventListener('message', event => {\n\n\tconst data = event.data;\n\n\t// Open cache for actions\n\tcaches.open(CACHE_NAME).then(cache => {\n\t\tswitch (data.type) {\n\n\t\t\tcase 'fallover': {\n\t\t\t\t// Has this already been added?\n\t\t\t\tfalloverStore.all().then(fallover => {\n\t\t\t\t\tconst match = fallover.filter(item => item.mode === data.mode && item.url === data.url)[0];\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\t// does this need\n\t\t\t\t\t\tif (match.fallover === data.fallover) {\n\t\t\t\t\t\t\t// nothing to do\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst frequest = new Request(data.fallover, {mode: 'no-cors'});\n\n\t\t\t\t\tfetch(frequest).then(response => {\n\t\t\t\t\t\t// Just update the existing record\n\t\t\t\t\t\tif (match) {\n\t\t\t\t\t\t\tmatch.fallover = data.fallover;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfalloverStore.put(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cache.put(data.fallover, response);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'add': {\n\t\t\t\tconst request = new Request(data.url, {mode: 'no-cors'});\n\t\t\t\treturn fetch(request).then(response => cache.put(data.url, response));\n\t\t\t}\n\t\t}\n\t});\n});\n\n\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaW5kZXhkYi5qcyIsInNyYy9zdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gaW5kZXhTdG9yYWdlXG4vLyBUaGlzIHdyYXBzIGFuIGludGVyZmFjZSBhcm91bmQgSW5kZXhEQiB0byBjcmVhdGUgYW4gb2JqZWN0IHN0b3JlXG5cbi8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgZGJcbi8vIFRoZSBDYWNoZSBuYW1lIGlzIG9wdGlvbmFsLCBpdCB3aWxsIGFsbG93IHVzIHRvIGdyb3VwIHZhcmlvdXMgZGF0YXNldHMgKHRoZSBkZWZhdWx0IGlzIF9fdHJpY2tzX18pXG5cbmNsYXNzIERCIHtcblx0Y29uc3RydWN0b3IgKG5hbWUsIHZlcnNpb24sIHNjaGVtYSkge1xuICAgIC8vIERlZmluZSB0aGUgc2NoZW1hIHRvIHVzZSBpbiB0aGUgY29ubmVjdGlvblxuXHRcdHRoaXMuZGJfbmFtZSA9IG5hbWUgfHwgJ19fdHJpY2tzX18nO1xuXHRcdGlmICh0eXBlb2YgdmVyc2lvbiA9PT0gJ29iamVjdCcpIHtcblx0XHRcdHRoaXMudmVyc2lvbiA9IDE7XG5cdFx0XHR0aGlzLnNjaGVtYSA9IHZlcnNpb247XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0dGhpcy52ZXJzaW9uID0gdmVyc2lvbiB8fCAxO1xuXHRcdFx0dGhpcy5zY2hlbWEgPSBzY2hlbWE7XG5cdFx0fVxuXHRcdHRoaXMudGFibGVfbmFtZSA9ICdfX3RyaWNrc19fJztcblxuICAgIC8vIFJldHVybiBhIGZ1bmN0aW9uXG5cdFx0cmV0dXJuIE9iamVjdC5hc3NpZ24odGhpcy5zY29wZS5iaW5kKHRoaXMpLCB0aGlzKTtcblx0fVxuXG5cdHNjb3BlIChuYW1lKSB7XG4gICAgLy8gQ3JlYXRlIGEgbmV3IHN0b3JlIGluc3RhbmNlXG5cdFx0Y29uc3QgaW5zdCA9IE9iamVjdC5jcmVhdGUodGhpcyk7XG5cdFx0aW5zdC50YWJsZV9uYW1lID0gbmFtZTtcblx0XHRyZXR1cm4gaW5zdDtcblx0fVxuXG5cdG9wZW4obW9kZSkge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgoYWNjZXB0LCByZWplY3QpID0+IHtcblx0XHRcdGNvbnN0IGRiID0gc2VsZi5pbmRleGVkREIub3Blbih0aGlzLmRiX25hbWUsIHRoaXMudmVyc2lvbik7XG5cdFx0XHRkYi5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XG5cdFx0XHRcdGFjY2VwdChldmVudC50YXJnZXQucmVzdWx0KTtcblx0XHRcdH07XG5cdFx0XHRkYi5vbmVycm9yID0gcmVqZWN0O1xuXHRcdFx0ZGIub251cGdyYWRlbmVlZGVkID0gZXZlbnQgPT4ge1xuXHRcdFx0XHRjb25zdCBkYiA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgIC8vIHRoaXMgc2hvdWxkIHByb2JhYmx5IGRvIHNvbWV0aGluZztcblx0XHRcdFx0Zm9yIChjb25zdCB4IGluIHRoaXMuc2NoZW1hKSB7XG5cdFx0XHRcdFx0aWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHgpKSB7XG5cdFx0XHRcdFx0XHRkYi5jcmVhdGVPYmplY3RTdG9yZSh4LCB0aGlzLnNjaGVtYVt4XSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9O1xuXHRcdH0pXG4gICAgLnRoZW4oZGIgPT4ge1xuXG4gICAgICAvLyBEb2VzIHRoZSBzdG9yZSByZXF1ZXN0ZWQgZXhpc3Q/XG4gICAgICAvLyBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnModGhpcy50YWJsZV9uYW1lKSkge1xuICAgICAgLy8gICBkYi50cmFuc2FjdGlvbigndmVyc2lvbmNoYW5nZScpLmNyZWF0ZU9iamVjdFN0b3JlKHRoaXMudGFibGVfbmFtZSwgdGhpcy5zY2hlbWFbdGhpcy50YWJsZV9uYW1lXSk7XG4gICAgICAvLyB9XG5cbiAgICAgIC8vIFRoZSBEQiBjb25uZWN0aW9uIGhhcyBiZWVuIGVzdGFibGlzaGVkXG4gICAgICAvLyBMZXRzIGNyZWF0ZSBhIGNvbm5lY3Rpb24gdG8gaXRcblx0Y29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbdGhpcy50YWJsZV9uYW1lXSwgbW9kZSk7XG5cbiAgICAgIC8vIFJldHVybiB0aGUgQVBJIGZvciB0aGUgT2JqZWN0IFN0b3JlXG5cdHJldHVybiB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0aGlzLnRhYmxlX25hbWUpO1xufSk7XG5cdH1cblxuXHRnZXQgKGtleSkge1xuXG4gICAgLy8gV2UndmUgZ290IGFsbCB0aGUgaW5mb3JtYXRpb24gdG8gbWFrZSBhIHJlcXVlc3QgdG8gSW5kZXhEQlxuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgoYWNjZXB0LCByZWplY3QpID0+IHtcblx0XHRcdHRoaXMub3BlbigpLnRoZW4ob2JqZWN0U3RvcmUgPT4ge1xuICAgICAgICAgIC8vIEZpbmQgaXRlbXMgaW4gdGhpcyB0YWJsZSBieSBLZXlcblx0XHRcdFx0Y29uc3QgcmVxdWVzdCA9IG9iamVjdFN0b3JlLmdldChrZXkpO1xuXHRcdFx0XHRyZXF1ZXN0Lm9uc3VjY2VzcyA9IGV2ZW50ID0+IHtcblx0XHRcdFx0XHRhY2NlcHQoZXZlbnQudGFyZ2V0LnJlc3VsdCk7XG5cdFx0XHRcdH07XG5cdFx0XHRcdHJlcXVlc3Qub25lcnJvciA9IGV2ZW50ID0+IHtcblx0XHRcdFx0XHRyZWplY3QoZXZlbnQudGFyZ2V0LnJlc3VsdCk7XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdGFsbCAoKSB7XG5cbiAgICAvLyBXZSd2ZSBnb3QgYWxsIHRoZSBpbmZvcm1hdGlvbiB0byBtYWtlIGEgcmVxdWVzdCB0byBJbmRleERCXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChhY2NlcHQsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5vcGVuKCkudGhlbihvYmplY3RTdG9yZSA9PiB7XG4gICAgICAgICAgLy8gRmluZCBpdGVtcyBpbiB0aGlzIHRhYmxlIGJ5IEtleVxuXHRcdFx0XHRjb25zdCByZXF1ZXN0ID0gb2JqZWN0U3RvcmUub3BlbkN1cnNvcigpO1xuXHRcdFx0XHRyZXF1ZXN0Lm9uZXJyb3IgPSBldmVudCA9PiB7XG5cdFx0XHRcdFx0cmVqZWN0KGV2ZW50LnRhcmdldC5yZXN1bHQpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGNvbnN0IGEgPSBbXTtcblx0XHRcdFx0cmVxdWVzdC5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgY3Vyc29yID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcblx0XHRcdFx0XHRpZiAoY3Vyc29yKSB7XG5cdFx0XHRcdFx0XHRhLnB1c2goY3Vyc29yLnZhbHVlKTtcblx0XHRcdFx0XHRcdGN1cnNvci5jb250aW51ZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdGFjY2VwdChhKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdHB1dCAoa2V5LCBkYXRhKSB7XG5cblx0XHRyZXR1cm4gbmV3IFByb21pc2UoKGFjY2VwdCwgcmVqZWN0KSA9PiB7XG5cbiAgICAgIC8vIEFsbG93IGRhdGEgYXMgYSB0aGluZyBvbiBpdHMgb3duLlxuXHRcdFx0aWYgKHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7XG5cdFx0XHRcdGRhdGEgPSBrZXk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0ZGF0YS5rZXkgPSBrZXk7XG5cdFx0XHR9XG5cbiAgICAgIC8vIE9wZW4gdXAgYSBjb25uZWN0aW9uIHRvIGluZGV4ZGJcblx0XHRcdHRoaXMub3BlbigncmVhZHdyaXRlJykudGhlbihvYmplY3RTdG9yZSA9PiB7XG5cdFx0XHRcdGNvbnN0IHJlcXVlc3QgPSBvYmplY3RTdG9yZS5wdXQoZGF0YSk7XG5cdFx0XHRcdHJlcXVlc3Qub25zdWNjZXNzID0gZXZlbnQgPT4ge1xuXHRcdFx0XHRcdGFjY2VwdChldmVudC50YXJnZXQucmVzdWx0KTtcblx0XHRcdFx0fTtcblx0XHRcdFx0cmVxdWVzdC5vbmVycm9yID0gZXZlbnQgPT4ge1xuXHRcdFx0XHRcdHJlamVjdChldmVudC50YXJnZXQucmVzdWx0KTtcblx0XHRcdFx0fTtcblx0XHRcdH0pXG4gICAgICAuY2F0Y2gocmVqZWN0KTtcblxuXHRcdH0pO1xuXG5cdH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBEQjtcbiIsIi8vIFNlcnZpY2UgV29ya2VyXG4vLyBDYWNoZXMgcGFnZXMgdmlzaXRlZCBieSBhZ2VudCBmb3Igdmlld2luZyBvZmZsaW5lXG5cbmNvbnN0IENBQ0hFX05BTUUgPSAnYWRvZHNvbl9zdyc7XG5jb25zdCBWRVJTSU9OID0gMTtcblxuY29uc3QgREIgPSByZXF1aXJlKCcuL2luZGV4ZGInKTtcbmNvbnN0IGRiID0gbmV3IERCKCdhZG9kc29uX3N3JywgVkVSU0lPTiwge1xuXHRmYWxsb3ZlclN0b3JlOiB7XG5cdFx0YXV0b0luY3JlbWVudDogdHJ1ZVxuXHR9XG59KTtcblxuY29uc3QgZmFsbG92ZXJTdG9yZSA9IGRiKCdmYWxsb3ZlclN0b3JlJyk7XG5cbnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignaW5zdGFsbCcsIGV2ZW50ID0+IHtcblx0Ly8gUGVyZm9ybSBpbnN0YWxsIHN0ZXBzXG5cdGV2ZW50LndhaXRVbnRpbChcblx0XHRjYWNoZXMub3BlbihDQUNIRV9OQU1FKS50aGVuKCgpID0+IHtcblx0XHRcdC8vIE9wZW5lZCBjYWNoZVxuXHRcdH0pXG5cdCk7XG59KTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHtcblx0Y29uc3QgcmVxdWVzdCA9IGV2ZW50LnJlcXVlc3Q7XG5cdGV2ZW50LnJlc3BvbmRXaXRoKGZldGNoKGV2ZW50LnJlcXVlc3QpXG5cdC50aGVuKHJlc3BvbnNlID0+IHtcblx0XHRcdC8vIENoZWNrIGlmIHdlIHJlY2VpdmVkIGEgdmFsaWQgcmVzcG9uc2Vcblx0XHRpZiAoIXJlc3BvbnNlIHx8IHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwIHx8IHJlc3BvbnNlLnR5cGUgIT09ICdiYXNpYycpIHtcblx0XHRcdHJldHVybiByZXNwb25zZSB8fCBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgcmVzcG9uc2VUb0NhY2hlID0gcmVzcG9uc2UuY2xvbmUoKTtcblxuXHRcdGNhY2hlcy5vcGVuKENBQ0hFX05BTUUpLnRoZW4oY2FjaGUgPT4ge1xuXHRcdFx0Y2FjaGUucHV0KGV2ZW50LnJlcXVlc3QsIHJlc3BvbnNlVG9DYWNoZSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gcmVzcG9uc2U7XG5cdH0sXG5cdCgpID0+XG5cdFx0Ly8gcmV0dXJuIHRoZSBjYWNoZWQgdmVyc2lvblxuXHRcdGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKHJlc3AgPT4ge1xuXG5cdFx0XHQvLyBGYWxsb3ZlclxuXHRcdFx0aWYgKHJlc3ApIHtcblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9XG5cblx0XHRcdC8vIERvZXMgdGhpcyBoYXZlIGEgZmFsbG92ZXI/XG5cdFx0XHRyZXR1cm4gZmFsbG92ZXJTdG9yZS5hbGwoKS50aGVuKGZhbGxvdmVyID0+IHtcblxuXHRcdFx0XHRjb25zdCBtYXRjaCA9IGZhbGxvdmVyLmZpbHRlcihpdGVtID0+IChcblx0XHRcdFx0XHQoIWl0ZW0ubW9kZSB8fCBpdGVtLm1vZGUgPT09IHJlcXVlc3QubW9kZSlcblx0XHRcdFx0XHQmJiAoIWl0ZW0udXJsIHx8IHJlcXVlc3QudXJsLm1hdGNoKGl0ZW0udXJsKSlcblx0XHRcdFx0KSlbMF07XG5cblx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGNhY2hlcy5tYXRjaChuZXcgUmVxdWVzdChtYXRjaC5mYWxsb3ZlcikpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJlc3A7XG5cdFx0XHR9KTtcblx0XHR9KVxuXHQpKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBldmVudCA9PiB7XG5cblx0Y29uc3QgZGF0YSA9IGV2ZW50LmRhdGE7XG5cblx0Ly8gT3BlbiBjYWNoZSBmb3IgYWN0aW9uc1xuXHRjYWNoZXMub3BlbihDQUNIRV9OQU1FKS50aGVuKGNhY2hlID0+IHtcblx0XHRzd2l0Y2ggKGRhdGEudHlwZSkge1xuXG5cdFx0XHRjYXNlICdmYWxsb3Zlcic6IHtcblx0XHRcdFx0Ly8gSGFzIHRoaXMgYWxyZWFkeSBiZWVuIGFkZGVkP1xuXHRcdFx0XHRmYWxsb3ZlclN0b3JlLmFsbCgpLnRoZW4oZmFsbG92ZXIgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IG1hdGNoID0gZmFsbG92ZXIuZmlsdGVyKGl0ZW0gPT4gaXRlbS5tb2RlID09PSBkYXRhLm1vZGUgJiYgaXRlbS51cmwgPT09IGRhdGEudXJsKVswXTtcblx0XHRcdFx0XHRpZiAobWF0Y2gpIHtcblx0XHRcdFx0XHRcdC8vIGRvZXMgdGhpcyBuZWVkXG5cdFx0XHRcdFx0XHRpZiAobWF0Y2guZmFsbG92ZXIgPT09IGRhdGEuZmFsbG92ZXIpIHtcblx0XHRcdFx0XHRcdFx0Ly8gbm90aGluZyB0byBkb1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNvbnN0IGZyZXF1ZXN0ID0gbmV3IFJlcXVlc3QoZGF0YS5mYWxsb3Zlciwge21vZGU6ICduby1jb3JzJ30pO1xuXG5cdFx0XHRcdFx0ZmV0Y2goZnJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gSnVzdCB1cGRhdGUgdGhlIGV4aXN0aW5nIHJlY29yZFxuXHRcdFx0XHRcdFx0aWYgKG1hdGNoKSB7XG5cdFx0XHRcdFx0XHRcdG1hdGNoLmZhbGxvdmVyID0gZGF0YS5mYWxsb3Zlcjtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRmYWxsb3ZlclN0b3JlLnB1dChkYXRhKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdHJldHVybiBjYWNoZS5wdXQoZGF0YS5mYWxsb3ZlciwgcmVzcG9uc2UpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRjYXNlICdhZGQnOiB7XG5cdFx0XHRcdGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdChkYXRhLnVybCwge21vZGU6ICduby1jb3JzJ30pO1xuXHRcdFx0XHRyZXR1cm4gZmV0Y2gocmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiBjYWNoZS5wdXQoZGF0YS51cmwsIHJlc3BvbnNlKSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcbn0pO1xuXG5cbiJdfQ=="}